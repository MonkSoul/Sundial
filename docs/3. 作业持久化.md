## 3. 作业持久化

`Sundail` 默认采用内存存储 `IJobDetail` 信息，开发者可以使用任何数据库或存储介质进行替换。只需要实现 `IJobStorer` 接口即可，如：

```cs
/// <summary>
/// 基于内存作业存储器（默认实现）
/// </summary>
public sealed class EFCoreJobStorer : IJobStorer
{
    /// <summary>
    /// 注册作业
    /// </summary>
    /// <param name="identity"></param>
    public void Register(string identity)
    {
        using(var context = new YourDbContext())
        {
            var jobDetail = new JobDetail(identity)
            {
                Status = JobStatus.Normal
            };

            context.JobDetails.Add(jobDetail);
            context.SaveChanges();
        }
    }

    /// <summary>
    /// 根据作业标识获取作业详细信息
    /// </summary>
    /// <param name="identity">唯一标识</param>
    /// <param name="cancellationToken">取消任务 Token</param>
    /// <returns><see cref="IJobDetail"/> 实例</returns>
    public async Task<IJobDetail> GetAsync(string identity, CancellationToken cancellationToken)
    {
        IJobDetail jobDetail;

        using(var context = new YourDbContext())
        {
            jobDetail = await context.JobDetails.SingleAsync(u => u.Identity == identity);
        }

        return jobDetail;
    }

    /// <summary>
    /// 更新作业详细信息
    /// </summary>
    /// <param name="detail">作业详细信息</param>
    /// <param name="cancellationToken">取消任务 Token</param>
    /// <returns><see cref="Task"/> 实例</returns>
    public async Task UpdateAsync(IJobDetail detail, CancellationToken cancellationToken)
    {
        using(var context = new YourDbContext())
        {
            var jobDetail = await context.JobDetails.SingleAsync(u => u.Identity == detail.Identity);
            jobDetail.Status = detail.Status;
            jobDetail.XXX = detail.XXX;
            // ...

            await context.SaveChangesAsync();
        }
    }
}
```

最后，替换默认 `IJobStorer`：

```cs
services.AddSundial(builder =>
{
    builder.AddJob<YourJob>();
    builder.ReplaceStorer(serviceProvider => 
    {
        var efcoreStorer = new EFCoreJobStorer();
        return efcoreStorer;
    })
});
```